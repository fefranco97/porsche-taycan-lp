---
import EDPForm from "./EDPForm";
---

<script>

    const handleImageLoad = (screenSize:number) => {
        const imagePath = screenSize < 768  ? '/images/banner-landingpage-porsche-mobile.png' : '/images/top-banner-porsche.svg';
        const imageElement = document.getElementById('hero-image') as HTMLImageElement;

        console.log(imagePath);
        if (imageElement) {
            imageElement.src = imagePath;
        }
    };

    let screenSize = window.innerWidth;

    window.addEventListener('resize', () => {
        screenSize = window.innerWidth;
        handleImageLoad(screenSize);
    });

    handleImageLoad(screenSize);

    let isFormOpen = false;

    const toggleForm = () => {
        isFormOpen = !isFormOpen;
        console.log('Toggling form, new state:', isFormOpen);
        const event = new CustomEvent('toggleForm', { detail: { isOpen: isFormOpen } });
        window.dispatchEvent(event);
    };

    const resetFormState = () => {
        isFormOpen = false;
        console.log('Resetting form state');
        const event = new CustomEvent('resetForm');
        window.dispatchEvent(event);
    };

    const initializeEventListeners = () => {
        const searchButton = document.getElementById('search-button');
        const cardNumberInput = document.getElementById('card-number');

        console.log('Initializing event listeners...');
        console.log('Search button found:', !!searchButton);
        console.log('Card input found:', !!cardNumberInput);

        if (searchButton) {
            // Remove event listener anterior se existir
            searchButton.removeEventListener('click', handleSearchClick);
            searchButton.addEventListener('click', handleSearchClick);
        }

        if (cardNumberInput) {
            // Remove event listener anterior se existir  
            cardNumberInput.removeEventListener('keypress', handleInputKeypress);
            cardNumberInput.addEventListener('keypress', handleInputKeypress);
        }
    };

    const handleSearchClick = (e: Event) => {
        e.preventDefault();
        console.log('Search button clicked');
        toggleForm();
    };

    const handleInputKeypress = (e: KeyboardEvent) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            console.log('Enter key pressed');
            toggleForm();
        }
    };

    resetFormState();

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeEventListeners);
    } else {
        initializeEventListeners();
    }

    window.addEventListener('pageshow', () => {
        resetFormState();
        setTimeout(initializeEventListeners, 100); 
    });

</script>



<section class="relative">
<div class="flex-1 w-full flex flex-col justify-center items-center text-white text-center relative font-light">
    <img id="hero-image" alt="Hero Banner" class="w-full md:block md:w-full" />

    <div class="absolute px-10 bottom-15 md:bottom-10 flex flex-col gap-7 justify-center items-center text-white text-center xl:bottom-43 2xl:bottom-55">
        <p class="text-sm md:text-lg xl:text-3xl">Pioneirismo em Mobilidade Elétrica com emoção e performance.
        <br>Você está pronto para o futuro verde?</p>
        <p class="text-sm md:text-lg xl:text-xl">Já tem um EV Card? Ative-o agora.</p>
    </div>
</div>

<div class="relative bg-[#062021] md:bg-[#011f1D] -mt-10 p-10 pb-16 py-12 w-full flex justify-center xl:-mt-40">  
    <div class=" flex gap-8 text-white items-center justify-center font-light md:w-2/3 xl:w-1/3">
        <p class="text-sm md:text-lg">Digite o número do seu EV.Card</p>
        <p class="text-sm md:text-lg">Vincule o cartão aos seus dados </p>
        <p class="hidden md:block text-sm md:text-lg">Ative o cartão e para pronto para usar</p>
    </div>
</div>

<div class="flex flex-col items-center justify-center w-full relative">
    <div class="relative bottom-6 z-20 w-3/4 md:w-2/3 xl:w-1/3">
        <input id="card-number" name="card-number" type="number" class="bg-white border-none rounded-md shadow-md p-4 pr-14 placeholder:text-[#DBDBDB] font-light w-full focus:outline-none"
        placeholder="Digite o número do cartão"/>
        
        <button id="search-button" class="absolute right-4 top-1/2 transform -translate-y-1/2 hover:opacity-80 transition-opacity">
            <svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M18.104 12.6116C18.104 9.63399 15.5892 7.11916 12.6116 7.11916V5.74606C16.3334 5.74606 19.4771 8.88977 19.4771 12.6116H18.104ZM19.931 18.8421C19.598 19.2335 19.2328 19.598 18.8421 19.931L24.9696 26.0584L26.0584 24.9696L19.931 18.8421ZM12.6144 20.8558C14.1097 20.8558 15.5096 20.4493 16.7186 19.7497L14.8725 17.9029L15.8433 16.9321L17.8686 18.9575C18.264 18.6286 18.6293 18.264 18.9575 17.8686L16.9321 15.8433L17.9029 14.8725L19.7491 16.7193C20.4486 15.5096 20.8558 14.1091 20.8558 12.6144C20.8558 8.07016 17.1587 4.3731 12.6144 4.3731C8.07017 4.3731 4.3731 8.07016 4.3731 12.6144C4.3731 17.1587 8.07017 20.8558 12.6144 20.8558ZM28 24.9696L24.9696 28L17.7196 20.75C16.2394 21.6817 14.4928 22.2289 12.6144 22.2289C7.30398 22.2289 3 17.9242 3 12.6144C3 7.30398 7.30398 3 12.6144 3C17.9242 3 22.2289 7.30398 22.2289 12.6144C22.2289 14.4928 21.6817 16.2394 20.75 17.7196L28 24.9696Z" fill="#616161"/>
            </svg>
        </button>
    </div>
    
    <!-- Container para o formulário com fundo animado -->
    <div class="w-full flex justify-center">
        <EDPForm isOpen={false} client:load/>
    </div>
</div>

</section>
